"use strict";function DragValidate(t,a){var e,i=!1;t.mousedown(function(t){a.text(""),i=!0,e=t.clientX}),$(document).mousemove(function(a){if(i){var n=(a=a||window.event).clientX-e;return!(n<30)&&(n>=230?(n=200,!1):(t.width(n+"px"),!1))}}),$(document).mouseup(function(e){t.width()<220?(t.width("30px"),a.text(">>拖动滑块验证<<")):(t.attr("validate","true").text("验证成功！").unbind("mousedown"),$("#login-submit").removeClass("btn-disabled").attr("disabled",!1)),i=!1})}function loginSucc(){$(".modal").hide(),$("div.form-info").hide(),$("#login-form").css("display","none"),$(".wc-box").css("display","block")}function rePwd(t,a){a===$("#reg-pwd").val()?$("#re-pwd").next("span").removeClass("error"):$("#re-pwd").next("span").addClass("error")}function showBookDetail(t,a){t.preventDefault(),$(".modal").show(),$("#modal-content").css("display","none"),$.ajax({type:"GET",url:"dist/data/getbybid.php",data:{bid:a},success:function(t){var a,e="",i=parseInt(.9*t.price)+".00";switch(t.type){case"1":a="新书推荐";break;case"2":a="文学经典";break;case"3":a="精彩小说";break;case"4":a="人文科技";break;default:a="好书推荐"}e='<div class="detail-nav"><span>'+a+"</span> > <b>"+t.name+'</b> >详情 </div>\n                <div class="detail-content">\n                <div class="img-box">\n                    <img class="detail-img" src="dist/img/'+t.img+'" alt="">\n                </div>\n                    <div class="detail-entry">\n                        <h3>'+t.name+" <span>"+t.author+"</span></h3>\n                        <h4>"+t.title+"</h4>\n                        <h4><span>￥"+i+"</span> <s>￥"+t.price+"</s> <b>全场任意商品9折起</b></h4>\n                        <p>"+t.detail+'</p>\n                    </div>\n                </div>\n                <div class="detail-btn">\n                    <div class="btn-group">\n                        <a disabled="disabled" title="结算功能暂不可用" id="btn-order">立刻购买</a>\n                        <button data-bid="'+t.bid+'" class="btn-add">加入购物车</button>\n                    </div>\n                </div>',$("#book-detail").html(e)}}),$("#book-detail").css("display","block").animate({top:0},300)}function cartJoin(t){$.ajax({type:"POST",url:"dist/data/cart_join.php",data:{uid:sessionStorage.uid,bid:t},success:function(t){}})}function goLogin(){$("html,body").animate({scrollTop:"0px"},800,function(){$(".login-collapse").slideDown(300)})}function fly(t,a,e,i,n){var s=t.attr("src");$('<img class="flyer-img" src="'+s+'">').css({width:150,height:150,borderRadius:100,zIndex:2e3}).fly({start:{left:e.clientX+i,top:e.clientY+n},end:{left:a.left-$(document).scrollLeft(),top:a.top-$(document).scrollTop(),width:20,height:20},vertex_Rtop:50,speed:1.4,onEnd:function(){timerHide("clear"),e.target.removeAttribute("disabled"),this.destroy(),showCartDetail(),$(".cart-detail").fadeIn(300).scrollTop(),$(".CS-content").scrollTop(""),timerHide()}})}function showCartDetail(){$.ajax({type:"GET",url:"dist/data/cart_detail.php",data:{uid:sessionStorage.uid},success:function(t){if(t.length){for(var a="",e=0,i=0,n="",s=0;s<t.length;s++){var o=t[s];a+="<li data-bid='"+o.bid+'\'>\n                    <a class="left" href="#"><img src="dist/img/'+o.img+'" alt=""></a>\n                    <div class="center">\n                        <a href="">\n                            <span class="name">'+o.name+'</span>\n                            <span class="num">x'+o.count+"</span>\n                        </a>\n                        <p>￥"+o.price+'</p>\n                    </div>\n                    <span class="delete"></span>\n                </li>',e+=parseInt(o.count),i+=parseInt(o.price*o.count)}n='  <div>\n                         <p>共<b class="b-num">'+e+'</b>件商品</p>\n                         <p class="totail">￥'+parseInt(.9*i)+'.00 <span>全场9折促销中</span></p>\n                       </div>\n                       <a disabled="disabled" title="结算功能暂不可用" class="clearing" href="">立即结算</a>\n                      ',$("ul.CS-content").show().html(a).scrollTop(9999),$(".result").removeClass("empty").html(n),$(".count").show().html(e)}else 0===t.length&&($("ul.CS-content").hide(),$(".result").html("").addClass("empty"),$(".count").hide())}})}function timerHide(t){"clear"===t?(clearTimeout(timer),timer=null):t||(timer=setTimeout(function(){$(".cart-detail").fadeOut(300)},6e3))}function showSuggest(t){$.ajax({type:"GET",url:"dist/data/getsuggest.php",data:{kw:t},success:function(t){var a="";if(t.length){for(var e=0;e<t.length;e++){var i=t[e];a+=' <li data-bid="'+i.bid+'">\n                        <img src="dist/img/'+i.img+'" alt="">\n                        <b>'+i.name+"<span>"+i.author+"</span></b>\n                    </li>"}$("#suggest")[0].className=""}else 0===t.length&&($("#suggest")[0].className="empty");$("#suggest").html(a)}})}function showData(t){var a="";return $.each(t,function(t,e){a+='<li>\n                    <img class="lazy" data-src="dist/img/'+e.img+'" src="dist/img/loading.gif"\n                    style="width:193px;height:193px;"\n                    title="'+e.title+'">\n                    <div class="outer">\n                        <div class="p-name">'+e.name+'</div>\n                        <div class="p-price">￥'+e.price+'</div>\n                    </div>\n                    <div class="inner">\n                        <div data-bid="'+e.bid+'" class="btn-group">\n                            <a class="a-detail" href="#">查看详情</a>\n                            <button class="btn-add">加入购物车</button>\n                        </div>\n                    </div>\n                </li>'}),a}function lazyload(t,a){if($(window).scrollTop()-a[0].offsetTop>-600){var e=a.find("img.lazy");$.each(e,function(t,a){var e=a.getAttribute("data-src");a.setAttribute("src",e)})}}function showBack(t,a){$(window).scrollTop()>800?a.fadeIn(300):a.fadeOut(300)}$(function(){$.ajax({type:"GET",url:"dist/data/get_new.php",success:function(t){$("#book-new .middle ul").html(showData(t))}}),$.ajax({type:"GET",url:"dist/data/get_hot.php",success:function(t){var a="";$.each(t,function(t,e){a+='<li data-bid="'+e.bid+'" class="hot-item">\n                            <i></i>\n                            <span>'+(t+1)+"</span>\n                            <p>"+e.name+'</p>\n                            <div class="detail">\n                                <div class="p-img">\n                                    <img src="dist/img/'+e.img+'" title="'+e.title+'">\n                                </div>\n                                <div class="p-msg">\n                                    <div class="p-name">\n                                       <a href="#">'+e.name+"</a>\n                                       <p>月销量："+e.sellCount+"</p>\n                                    </div>\n                                </div>\n                            </div>\n                            </li>\n                           "}),$(".book-hot .hot-content").html(a),$(".hot-content li").eq(0).addClass("active"),$(".hot-item i").addClass("line").eq(0).remove()}}),$.ajax({type:"GET",url:"dist/data/get_others.php",success:function(t){var a=t.wd;$("#book-wonder .middle ul").html(showData(a));var e=t.art;$("#book-art .middle ul").html(showData(e))}}),showCartDetail(),$(window).scroll(function(t){lazyload(t,$("#book-new")),lazyload(t,$("#book-wonder")),lazyload(t,$("#book-art")),showBack(t,$(".backtop"))})});var carousel={TIMER:null,init:function(){this.autoPlay(),$(".banner-ctrl ul").on("click","span",function(){var t=$(this).parent().index();carousel.play(t)}),$(".banner").mouseover(function(){clearInterval(carousel.TIMER)}).mouseout(function(){setTimeout(carousel.autoPlay(),3e3)})},autoPlay:function(){this.TIMER=setInterval(function(){var t=$(".banner li.active").index()+1;carousel.play(t)},3e3)},play:function(t){t>=$(".banner .item").size()&&(t=0),$(".banner li.active").removeClass("active"),$(".banner li.item").eq(t).addClass("active"),$(".banner-ctrl li.in").removeClass("in"),$(".banner-ctrl li").eq(t).addClass("in")}};carousel.init(),sessionStorage.uname?($("#login-form").css("display","none"),$(".wc-box").css("display","block"),$(".wc-name").html(sessionStorage.uname)):$("#login-submit").click(function(t){t.preventDefault();var a=$("#login-form").serialize();$.ajax({url:"dist/data/login.php",type:"POST",data:a,success:function(t){2===t.code?$("div.form-info").show().children("p").html(t.msg):1===t.code&&(loginSucc(),$(".wc-name").html(t.uname),sessionStorage.uname=t.uname,sessionStorage.uid=t.uid,showCartDetail())}})}),DragValidate($("#dragEle"),$(".tips")),$(".quit a").click(function(){sessionStorage.removeItem("uname"),sessionStorage.removeItem("uid"),location.reload()}),$("#goReg").click(function(t){t.stopPropagation(),t.preventDefault(),$(".modal").show(),$("#book-detail").css("display","none"),$("#modal-content").css("display","block").animate({top:0},300)}),$("#reg-form input").on("blur",function(){var t,a=$(this).val(),e=$(this).attr("name"),i=!1;switch(e){case"reg-name":t=/^\w{6,12}$/g;break;case"reg-pwd":t=/^\w{8,15}$/g,$("#re-pwd").val()&&rePwd($(this),$("#re-pwd").val());break;case"reg-email":t=/^\w+@[a-z0-9]+(\.[a-z]{2,3}){1,2}$/g;break;case"reg-phone":t=/^1[34578]\d{9}$/;break;case"re-pwd":return void rePwd($(this),a)}"re-pwd"!=e&&(t.test(a)?$(this).next("span").removeClass("error"):$(this).next("span").addClass("error")),$("#reg-form input").each(function(){i=""!=$(this).val()&&!$(this).next("span").hasClass("error")}),i&&$("#reg-submit").attr("disabled",!1).removeClass("btn-disabled").attr("title","点击注册")}),$("#reg-submit").click(function(t){t.preventDefault();var a=$("#reg-form").serialize(),e=$("#reg-name").val();$.ajax({type:"POST",url:"dist/data/regiest.php",data:a,success:function(t){1===t.code&&(loginSucc(),$(".wc-name").html(e),sessionStorage.uname=e,sessionStorage.uid=t.uid)}})}),$(".backtop").click(function(){$("html,body").animate({scrollTop:"0px"},800)}),$(function(){$(document).click(function(){$(".login-collapse").slideUp(),$(".cart-detail").fadeOut(300),$(".search-form input").removeClass("in"),$(".search-form").css("visibility","hidden"),$(".search").removeAttr("disabled"),$("#suggest").hide()}),$("#header").on("click",".search",function(t){"hidden"===$(".search-form").css("visibility")&&($(".search-form input").addClass("in")[0].addEventListener("transitionend",function(){$(this).keyup(function(){var t=$(this).val();/[\u4e00-\u9fa5]+/.test(t)&&showSuggest(t)}).focus(function(){$("#suggest").show().html("")[0].className="default"}).focus()},!0),$(".search-form").css("visibility","visible"),$(".search").attr("disabled",!0))}).on("click",".navbar",function(t){t.stopPropagation()}),$("#suggest").on("click","li",function(t){showBookDetail(t,$(this).data("bid"))}),$(".login-collapse").click(function(t){t.stopPropagation()}),$("a.login").on("click",function(t){t.stopPropagation(),$(".login-collapse").slideToggle(300)}),$(".modal").on("click",function(t){t.stopPropagation(),"modal"===t.target.className&&($("#modal-content").animate({top:-200},300,function(){$(".modal").hide()}),$("#book-detail").animate({top:-200},300,function(){$(".modal").hide()}))})}),$(".book-hot").on("mouseenter",".hot-item",function(){$(this).addClass("active").siblings(".active").removeClass("active")}),$(".middle").on("mouseover","li",function(){$(this).children(".outer").addClass("hide").siblings(".inner").addClass("active")}).on("mouseout","li",function(){$(this).children(".outer").removeClass("hide").siblings(".inner").removeClass("active")}),$("div.middle").on("click",".btn-add",function(t){t.preventDefault(),t.stopPropagation(),$(this).attr("disabled",!0);var a=$("#slide-bar li.shopcart").offset(),e=$(this).parent().parent().siblings("img");cartJoin($(this).parent(".btn-group").data("bid")),fly(e,a,t,-130,-170)}).on("click",".a-detail",function(t){showBookDetail(t,$(this).parent(".btn-group").data("bid"))}),$(".hot-content").on("click","li.hot-item",function(t){showBookDetail(t,$(this).data("bid"))}),$("#book-detail").on("click",".btn-add",function(t){$(this).attr("disabled",!0);var a=$("#slide-bar li.shopcart").offset(),e=$(".detail-img");cartJoin($(this).data("bid")),fly(e,a,t,-750,-250)}),$("li.shopcart").click(function(t){t.stopPropagation(),$(".cart-detail").fadeToggle(300)}),$(".cart-detail").on("mouseenter",function(){timerHide("clear")}).on("mouseleave",function(){timerHide()}).on("click","span.delete",function(t){t.stopPropagation();var a=$(this).parent("li"),e=a.data("bid");$.ajax({type:"GET",url:"dist/data/cart_delete.php",data:{bid:e},success:function(t){"succ"===t.msg&&a.animate({left:-222},700,function(){showCartDetail()})}})}),$(".CS-content").on("mouseover","li",function(){$(this).children("span.delete").show()}).on("mouseout","li",function(){$(this).children("span.delete").hide()});var timer=null;